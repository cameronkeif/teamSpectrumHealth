@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div id="body">
    <div id="listContainer" >
        <div id="severeContainer" class="container">
            <span class="secondaryTitle">Severe</span>
            <ul id="severeList" class="shortageList">
            </ul>
        </div>
        <div id="warningContainer" class="container">
            <span class="secondaryTitle">Warning</span>
            <ul id="warningList" class="shortageList">
            </ul>
        </div>
        <div id="goodContainer" class="container">
            <span class="secondaryTitle">Good</span>
            <ul id="goodList" class="shortageList">
            </ul>
        </div>
        <div id="recentContainer" class="container">
            <span class="secondaryTitle">Recent</span>
            <ul id="recentList" class="shortageList">
            </ul>
        </div>
    </div>
</div>

@section scripts{
<script type="text/javascript">
$(function()
{
    var watchListNdcs = Array();

    // On page load, 
    $.getJSON('/api/WatchListItem?username=' + '@Html.Encode(ViewData["Username"])', function (watchListJsonPayload) {
        $(watchListJsonPayload).each(function(i, watchListItem) {
            watchListNdcs.push(watchListItem.Ndc);
        });
    });

    console.log(watchListNdcs);

    $.getJSON('/api/DrugEntry', function(drugJsonPayload)
    {
        $(drugJsonPayload).each(function(i, item)
        {
            if (item.CurrentStatus === "severe") {
                $('#severeList').append('<p>' + item.Brand + ' ' + item.Dosage + '<a href="#" onClick="addToWatchList(' + '\'@Html.Encode(ViewData["Username"])\',\'' + item.NDC + '\')">' +
                    '<img src="/images/not_favorite_temp.png"' + 'align="right" /></a>' + '</p>');
            }
            else if (item.CurrentStatus === "warning") {
                $('#severeList').append('<p>' + item.Brand + ' ' + item.Dosage + '<a href="#" onClick="addToWatchList(' + '\'@Html.Encode(ViewData["Username"])\',\'' + item.NDC + '\')">' +
                    '<img src="/images/not_favorite_temp.png"' + 'align="right" /></a>' + '</p>');
            }
            else {
                $('#goodList').append('<p>' + item.Brand + ' ' + item.Dosage + '<a href="#" onClick="addToWatchList(' + '\'@Html.Encode(ViewData["Username"])\',\'' + item.NDC + '\')">' +
                    '<img src="/images/not_favorite_temp.png"' + 'align="right" /></a>' + '</p>');
            }
        });
    });
});

function addToWatchList(username, ndc) {
    $.post('/api/WatchListItem', { '': username + "&" + ndc })
    .done(function (data) {
        alert("Success");
    });
};
</script>
}